# プロンプトエンジニアリング入門

プロンプトエンジニアリングとは、AIに対して効果的な指示（プロンプト）を作成する技術です。このページでは、COBOLプログラマーの皆様にもわかりやすく、実践的なプロンプトの書き方を解説します。

!!! info "COBOLプログラマーの皆様へ"

    プロンプトは、COBOLのJCL（Job Control Language）のようなものです。適切な指示を与えることで、AIから期待する結果を得ることができます。

---

## プロンプトとは？

プロンプトは、AIに与える指示や質問のことです。

### COBOLとの類推

| COBOL/JCL | プロンプト |
|-----------|-----------|
| JOBカード | プロンプトの開始 |
| EXECステートメント | 実行したいタスクの指示 |
| DDステートメント | 入力データや条件の指定 |
| 出力ファイル | AIからの応答 |

**JCLの例：**
```jcl
//MYJOB    JOB (ACCT),'PROCESS DATA'
//STEP1    EXEC PGM=COBPROG
//INPUT    DD DSN=CUSTOMER.DATA,DISP=SHR
//OUTPUT   DD DSN=REPORT.DATA,DISP=(NEW,CATLG)
```

**プロンプトの例：**
```
タスク: 顧客データを処理してレポートを作成
入力: 顧客データ（CSV形式）
出力: 売上サマリーレポート
条件: 2024年のデータのみを対象とする
```

---

## 効果的なプロンプトの構成要素

### 1. 役割（Role）
AIにどのような立場で応答してほしいかを指定します。

```python
# 良い例
prompt = "あなたは経験豊富なCOBOLプログラマーです。"

# より具体的な例
prompt = "あなたは30年の経験を持つメインフレーム開発者で、COBOLからPythonへの移行を支援する専門家です。"
```

### 2. タスク（Task）
何をしてほしいのかを明確に指示します。

```python
# 曖昧な例（避けるべき）
prompt = "コードを書いて"

# 明確な例（推奨）
prompt = """
以下のCOBOLの顧客マスタ更新処理を、
Pythonで同等の機能を持つ関数として実装してください。
エラーハンドリングも含めてください。
"""
```

### 3. コンテキスト（Context）
背景情報や制約条件を提供します。

```python
prompt = """
コンテキスト:
- 既存のCOBOLシステムをPythonに移行中
- データベースはDB2からPostgreSQLに変更
- 文字コードはEBCDICからUTF-8に変換済み
- トランザクション処理が必要
"""
```

### 4. 例示（Examples）
期待する出力の例を示します（Few-shot prompting）。

```python
prompt = """
以下の形式でCOBOLコードをPythonに変換してください：

例1:
COBOL: MOVE WS-AMOUNT TO TOTAL-AMOUNT
Python: total_amount = ws_amount

例2:
COBOL: ADD 1 TO COUNTER
Python: counter += 1

変換対象:
COBOL: COMPUTE TAX = AMOUNT * 0.1
"""
```

### 5. 出力形式（Format）
応答の形式を指定します。

```python
prompt = """
以下の形式で回答してください：

1. 変換後のPythonコード
2. 主な変更点の説明（箇条書き）
3. 注意事項
"""
```

---

## プロンプトエンジニアリングのテクニック

### 1. Zero-shot Prompting
例を示さずに指示のみで回答を得る方法です。

```python
# Zero-shot の例
prompt = "顧客IDから顧客名を検索するPython関数を作成してください。"
```

### 2. Few-shot Prompting
いくつかの例を示してから回答を求める方法です。

```python
# Few-shot の例
prompt = """
以下の例を参考に、新しい関数を作成してください：

例1: get_customer_name(id) → 顧客名を返す
例2: get_customer_address(id) → 住所を返す

作成: get_customer_balance(id) → ?
"""
```

### 3. Chain of Thought (CoT)
段階的に考えさせる方法です。

```python
prompt = """
COBOLのバッチ処理をPythonに移行する手順を考えてください。
ステップごとに説明してください：

1. まず、入力ファイルの読み込み処理を...
2. 次に、データの検証を...
3. その後、ビジネスロジックを...
4. 最後に、出力ファイルの書き込みを...
"""
```

### 4. 制約の明示
やってほしくないことも明確に指示します。

```python
prompt = """
Pythonコードを生成してください。

必須要件:
- エラーハンドリングを含める
- 型ヒントを使用する
- docstringを記述する

禁止事項:
- グローバル変数を使用しない
- ハードコーディングしない
- 外部ライブラリは標準ライブラリのみ
"""
```

---

## 実践演習

### 演習1：基本的なプロンプト作成

以下のCOBOL処理をPythonに変換するプロンプトを作成してみましょう：

```cobol
* 売上集計処理
PROCEDURE DIVISION.
    PERFORM VARYING WS-INDEX FROM 1 BY 1
        UNTIL WS-INDEX > RECORD-COUNT
        ADD SALES-AMOUNT(WS-INDEX) TO TOTAL-SALES
    END-PERFORM.
    DISPLAY "総売上: " TOTAL-SALES.
```

**解答例：**
```python
prompt = """
あなたはCOBOLからPythonへの移行専門家です。

以下のCOBOL売上集計処理をPythonに変換してください：
[COBOLコード]

要件：
1. Pythonらしい書き方にする
2. リスト内包表記またはsum関数を活用
3. 型ヒントを含める
4. 簡潔なコメントを追加

出力形式：
- Pythonコード
- COBOLとの主な違いの説明
"""
```

### 演習2：デバッグ用プロンプト

AIが生成したコードが期待通りに動かない場合のプロンプト：

```python
debug_prompt = """
以下のPythonコードにバグがあります。
COBOLプログラマーにもわかりやすく問題点を説明し、
修正方法を提案してください。

コード：
[バグのあるコード]

症状：
- 期待値：100
- 実際の出力：0

考えられる原因を段階的に分析してください。
"""
```

### 演習3：段階的な移行プロンプト

```python
migration_prompt = """
大規模なCOBOLシステムをPythonに段階的に移行する計画を立ててください。

システム概要：
- 100本のCOBOLプログラム
- バッチ処理とオンライン処理の混在
- DB2データベース使用
- 日次、月次、年次処理あり

以下の観点で移行計画を作成：
1. 優先順位の決定基準
2. 移行の段階（フェーズ）
3. 各段階でのリスクと対策
4. 並行稼働期間の考慮事項
5. テスト戦略

表形式でまとめてください。
"""
```

---

## プロンプトの改善サイクル

### 1. 初期プロンプト
```python
prompt_v1 = "顧客データを処理するコードを書いて"
```

### 2. 問題の特定
- 曖昧すぎる
- 言語が不明
- 処理内容が不明確

### 3. 改善版
```python
prompt_v2 = """
Pythonで顧客データ（CSV）を読み込み、
以下の処理を行う関数を作成してください：
1. データ検証（必須項目チェック）
2. 重複除去
3. 売上金額の集計
4. 結果をJSONで出力
"""
```

### 4. さらなる改善
```python
prompt_v3 = """
役割: Pythonエキスパート

タスク: 顧客売上データ処理関数の作成

入力仕様:
- CSV形式（顧客ID, 顧客名, 売上金額, 日付）
- 文字コード: UTF-8
- ヘッダー行あり

処理要件:
1. pandasを使用してCSV読み込み
2. 必須項目（全フィールド）の存在確認
3. 顧客IDによる重複除去（最新日付を採用）
4. 顧客別売上集計

出力仕様:
- JSON形式
- 顧客ID、顧客名、総売上金額を含む

エラーハンドリング:
- ファイル読み込みエラー
- データ形式エラー
- 空ファイルの場合

コード規約:
- 型ヒント使用
- docstring記載
- 単体テスト可能な設計
"""
```

---

## よくある失敗と対策

### 1. 曖昧な指示
❌ **悪い例**: "いい感じにして"
✅ **良い例**: "可読性を高めるため、適切な変数名とコメントを追加してください"

### 2. 情報不足
❌ **悪い例**: "エラー処理を追加"
✅ **良い例**: "ファイルが存在しない場合とデータ形式が不正な場合のエラー処理を追加"

### 3. 矛盾する要求
❌ **悪い例**: "高速で、かつメモリを使わず、すべての機能を実装"
✅ **良い例**: "処理速度を優先し、メモリ使用量は1GB以内で主要機能を実装"

---

## プロンプトテンプレート集

### 1. コード変換用
```python
template_conversion = """
役割: {source_language}から{target_language}への変換専門家

タスク: 以下のコードを変換

入力コード:
{input_code}

要件:
- {target_language}のベストプラクティスに従う
- 元の機能を完全に保持
- 必要に応じてコメントで説明

出力:
1. 変換後のコード
2. 主な変更点
3. 注意事項
"""
```

### 2. トラブルシューティング用
```python
template_debug = """
状況: {error_description}

環境:
- 言語: {language}
- バージョン: {version}
- OS: {os}

エラーメッセージ:
{error_message}

関連コード:
{code_snippet}

以下を分析してください:
1. エラーの原因
2. 解決方法（複数提示）
3. 今後の予防策
"""
```

---

## まとめ

効果的なプロンプトエンジニアリングのポイント：

1. **明確性**: 曖昧さを排除し、具体的に指示
2. **構造化**: 役割、タスク、条件を整理
3. **例示**: 期待する出力の例を提供
4. **反復**: 結果を見て改善を繰り返す
5. **検証**: 出力が要求を満たしているか確認

プロンプトエンジニアリングは練習によって上達します。様々なプロンプトを試し、AIの応答を観察することで、より良い指示の出し方が身につきます。

---

> プロンプトエンジニアリングは、AIとの効果的なコミュニケーション方法です。COBOLでの厳密な仕様定義の経験は、良いプロンプト作成に必ず活きます。

[前へ ◀ AI・生成AIの基礎知識](watsonx_ai_basics.md)　｜　[次へ ▶ 環境のセットアップ](watsonx_setup.md)